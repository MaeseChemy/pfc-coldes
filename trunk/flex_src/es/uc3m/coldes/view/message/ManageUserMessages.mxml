<?xml version="1.0" encoding="utf-8"?>
<ResizableWindow xmlns="es.uc3m.coldes.utils.ui.resize.*" 
	close="close()"
	xmlns:mx="http://www.adobe.com/2006/mxml" resizable="false" movable="false" showCloseButton="true" xmlns:validator="es.uc3m.coldes.utils.validator.*" 
	width="500" height="200" horizontalAlign="center" verticalAlign="middle">
	<mx:Script>
		<![CDATA[
			import es.uc3m.coldes.entities.UserRoom;
			import mx.controls.Alert;
			import es.uc3m.coldes.entities.Room;
			import es.uc3m.coldes.business.RoomService;
			import es.uc3m.coldes.business.Constants;
			import es.uc3m.coldes.utils.popup.UtilPopUp;
			import mx.managers.PopUpManager;
			import es.uc3m.coldes.view.user.UserDataFormUpdate;
			import es.uc3m.coldes.business.UserService;
			import es.uc3m.coldes.entities.User;
			import mx.collections.ArrayCollection;
			
			[Bindable]
			public var messages:ArrayCollection = new ArrayCollection();
			
			private function close():void{
				PopUpManager.removePopUp(this);
			}
			
			private function renderMessage(item:Object, col:DataGridColumn):String {
				return "Invitacion para la sala ["+item.roomName+"] del usuario ("+item.ownerUserName+") como \"" +item.rolDescription+"\"";
			}
			
			public function accept(data:UserRoom):void{
				(new RoomService).manageUserRoomRelation(data, true, calbackUpdateMessage);
			}
			public function decline(data:UserRoom):void{
				(new RoomService).manageUserRoomRelation(data, false, calbackUpdateMessage);
			}
			
			private function calbackUpdateMessage(result:Number):void{
				if(result >= 0){
					(new RoomService()).getAllUserRoomInvitation(parentApplication.userLoged.username, calbackGetInvitations);
				}
			}
			private function calbackGetInvitations(invitations:ArrayCollection):void{
				parentApplication.userInvitationMessage = invitations;
				parentApplication.userMessages = parentApplication.userInvitationMessage.length;
				messages = parentApplication.userInvitationMessage;
				messages.refresh();
			}
		]]>
	</mx:Script>
	
	<mx:Canvas width="100%" height="100%">
	<mx:VBox id="vbox" width="100%" height="100%" >

		<mx:DataGrid id="gridUserMessages" width="100%" height="100%" dataProvider="{messages}" verticalScrollPolicy="auto"
			wordWrap="true" variableRowHeight="true">
			<mx:columns>
				<mx:DataGridColumn width="60" resizable="false">
					<mx:itemRenderer>
						<mx:Component >
							<mx:HBox width="100%" horizontalAlign="center">
								<mx:Script>
									<![CDATA[
										import es.uc3m.coldes.entities.UserRoom;
										private function accept():void{
											parentDocument.accept(data as UserRoom);
										}
										private function decline():void{
											parentDocument.decline(data as UserRoom);
										}
									]]>
								</mx:Script>
								<mx:Image buttonMode="true" source="assets/images/icos/mailremove.png"
										  toolTip="Rechazar" click="decline()"/>
								<mx:Image buttonMode="true" source="assets/images/icos/mailaccept.png"
										  toolTip="Aceptar" click="accept()"/>
							</mx:HBox>
						</mx:Component>
					</mx:itemRenderer>
				</mx:DataGridColumn>
				
				<mx:DataGridColumn headerText="Invitacion" labelFunction="renderMessage"/>
				<!--
				<mx:DataGridColumn headerText="Propietario" dataField="ownerUserName"/>
				<mx:DataGridColumn headerText="Nombre de la sala" dataField="roomName"/>
				<mx:DataGridColumn headerText="Rol a desempeÃ±ar" dataField="rolDescription"/>
				-->
			</mx:columns>
		</mx:DataGrid>
	</mx:VBox>
	</mx:Canvas>
		
</ResizableWindow>
